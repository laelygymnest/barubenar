<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin Racepack</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: orange; color: white; }
    .warning { background: #ffe6e6; padding: 10px; border: 1px solid red; margin-bottom: 15px; }
    input { width: 100%; }
  </style>
</head>
<body>

<div id="loginSection">
  <h2>Masukkan Password</h2>
  <input type="password" id="passwordInput">
  <button onclick="checkPassword()">Login</button>
</div>

<div id="contentSection" style="display:none;">
  <div class="warning">
    <strong>PERHATIAN:</strong> JIKA ADA PESERTA YANG PENGAMBILAN RACEPACKNYA DIWAKILKAN DAN TIDAK MEMBAWA SURAT KUASA, MAKA PESERTA BISA MENGIRIM SOFT FILE SURAT KUASA YANG SUDAH DI ISI DAN DITANDATANGANI BESERTA FOTO KTP DAN DI DM KE IG TEGAL CITY RUN. HAL INI UNTUK MENCEGAH HAL YANG TIDAK DIINGINKAN SEPERTI PENGAMBILAN RACEPACK BERULANG.  
    TUNJUKAN ID CARD & EMAIL VERIFIKASI
  </div>
  <table id="racepackTable">
    <thead>
      <tr>
        <th>No BIB</th>
        <th>Nama Peserta</th>
        <th>Size Baju</th>
        <th>Status</th>
        <th>Nama Staff</th>
        <th>Nama Pengambil</th>
        <th>No Tlp Pengambil</th>
        <th>ID Card Pengambil</th>
        <th>Keterangan</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzhfk2Sp6-DB2z5mCl2Ssl5AwPoNginMeqKycVP4JYqi9sY0X2Uim8UGhFRAC2NFVMC/exec";
const PASSWORD = "12345"; // ganti sesuai kebutuhan

document.addEventListener("DOMContentLoaded", () => {
  if (sessionStorage.getItem("loggedIn") === "true") {
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("contentSection").style.display = "block";
    loadData();
  }
});

function checkPassword() {
  const input = document.getElementById("passwordInput").value;
  if (input === PASSWORD) {
    sessionStorage.setItem("loggedIn", "true");
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("contentSection").style.display = "block";
    loadData();
  } else {
    alert("Password salah!");
  }
}

function loadData() {
  fetch(WEB_APP_URL)
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#racepackTable tbody");
      tbody.innerHTML = "";
      data.forEach((row, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row[0]}</td>
          <td>${row[1]}</td>
          <td>${row[2]}</td>
          <td><input value="${row[3] || ''}"></td>
          <td><input value="${row[4] || ''}"></td>
          <td><input value="${row[5] || ''}"></td>
          <td><input value="${row[6] || ''}"></td>
          <td><input value="${row[7] || ''}"></td>
          <td><input value="${row[8] || ''}"></td>
          <td><button onclick="saveRow(${index})">Simpan</button></td>
        `;
        tbody.appendChild(tr);
      });
    });
}

function saveRow(index) {
  const row = document.querySelectorAll("#racepackTable tbody tr")[index];
  const inputs = row.querySelectorAll("input");
  const updatedData = Array.from(inputs).map(input => input.value);

  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify({ rowIndex: index, updatedData }),
    headers: { "Content-Type": "application/json" }
  })
  .then(res => res.json())
  .then(resp => {
    if (resp.success) {
      alert("Data berhasil disimpan");
    } else {
      alert("Gagal menyimpan: " + resp.error);
    }
  });
}
</script>

</body>
</html>
